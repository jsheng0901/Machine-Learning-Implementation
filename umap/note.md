
### 基本原理
参考链接：
- [英文解释原理和tsne对比](https://towardsdatascience.com/how-exactly-umap-works-13e3040e1668)
- [中文翻译解释原理和tsne对比](https://zhuanlan.zhihu.com/p/150788883)
- [英文可视化解释原理](https://pair-code.github.io/understanding-umap/)
- [中文翻译可视化解释原理](https://zhuanlan.zhihu.com/p/352461768)
- [官网document解释](https://umap-learn.readthedocs.io/en/latest/)
### 优点
- 对比TSNE，对全局距离保留更好。
- 对比TSNE，速度更快，适用于大数据样本比如超过1M的数据。
- 对比TSNE，可以随意选择降到的维度并且可以保留相对局部和全局的信息，方便用于后续downstream work。虽然TSNE也可以随意选择维度降维，但是太大的维度选择对于困惑度的搜索将非常耗时。
- 背后的理论为代数拓扑学和黎曼几何学，更robust，更strong support。
- 对比TSNE，UMAP可以使用任何定义的距离作为metric，而不仅仅是欧几里得距离，这样有利于不同类型数据分布投影到低纬空间。
### 缺点
- 对比PCA需要调参，参数选择对结果影响很大。
- 调参需要引入一些domain knowledge，获取到想要的的全局性需要多几次调参。
- 相对比TSNE会更难解释，不过底层原理都是一样的，高纬空间在低纬空间的投射。
- 对于两个嵌套的簇，UMAP很难分开，尤其是在维度较高的情况下比如：100维。主要原因是因为高纬度的度的点之间的距离往往非常相似（维度的诅咒），UMAP将内部簇的外点与外部簇的外点连接起来。这看起来是把两个簇融合在一起了。
- 和TSNE一样，这一类的降维，cluster的大小毫无意义，只是在使用局部距离的概念来构造高纬图表示。
- 和TSNE一样，高纬度数据降维到低纬度，多少会有一点拥挤问题，所以设置降维的维度需要配合后续需求model进行调参。比如后续是clustering的model，那么此参数可以和后续的model参数放在一起调。
### 知识点提炼
- 参数解释
  - n_neighbors，用于构建初始高维图的近似最近邻点的数量。有效地控制了UMAP如何平衡局部结构和全局结构，低值会促使UMAP在分析高维数据时，通过约束考虑的邻点数量，更加关注局部结构，而高值则会促使UMAP倾向于表示大局结构，同时失去局部的细节。
  - min_dist，低维空间中点之间的最小距离。这个参数控制了UMAP将点紧密地聚集在一起的程度，数值越低，嵌入的点就越紧密。更大的min_dist值会使UMAP将点更松散地包装在一起，而专注于保存广泛的拓扑结构，数据的聚类减少，对全局结构的重视程度降低。
- 其它要点 
  - 相对比与TSNE，需要极高的 perplexity (~1000) 才能开始看到全局结构的出现，而在如此大的 perplexity 值下，计算的时间会大幅延长。然而UMAP并不需要困惑度，同等的数据集大概只需要1/4的时间达到同样的全局性效果。
  - UMAP和TSNE都是一种随机算法，但不同的运行和不同的参数，所得到的预测结果很相似。因为UMAP与TSNE相比，更加强调全局结构，不过这里需要把参数n_neighbors调高点，不然算法还是更关注局部结构。
  - 对比TSNE，UMAP的损失函数是CE，这样在对于高纬度的X的时候如果Y很小则损失函数很大，所以对于高纬度的X，Y的距离的确也希望较大，这样能保证更多的全局结构信息
  - 对比TSNE，加速的部分，主要是省略了高维和低纬概率的归一化，因为归一化需要求和或者积分这一步很费时的。
### Engineer Work
- 一般来说直接调用UMAP包来实现。实际生产中当维度达到50以上数据量大于1M的时候就不会那么高效了。解决方法和TSNE一样，可以混合PCA和UMAP，先PCA降维到50以下再UMAP。
- 实际工作中数据量巨大，虽然比TSNE快了很多，但还是一般不推荐在pipeline里面设计UMAP算法的component。多用于做可视化分析，协同理解数据分布的情况，来方便设计选择后续的clustering算法。
- 如一定需要降维，实际应用中可以先PCA在UMAP，这样可以快很多。